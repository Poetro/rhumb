(function(){function t(t,r){var n={},a=function(t,r){var e=t.shift();if(!e)return r.leaf||!1;if(r.fixed&&e in r.fixed)return a(t,r.fixed[e]);if(r.partial){var i=r.partial.tests,f=i.some(function(t){if(t.ptn.test(e)){var a=e.match(t.ptn);return t.vars.forEach(function(t,r){n[t]=a[r+1]}),r=t,!0}});if(f)return a(t,r)}return r.var?(n[r.var.name]=e,a(t,r.var)):!1},e=a(t,r,n);return e?{fn:e,params:n}:!1}function r(){var r={},e={},i=function(t,r,n){var a,e=t.shift(),f=!!t.length;if(e)if("fixed"==e.type)r.fixed||(r.fixed={}),a=r.fixed[e.input]||(r.fixed[e.input]={}),f?i(t,a,n):a.leaf=n;else if("var"==e.type){if(r.var)throw Error("Ambiguity");a=r.var={},a.name=e.input,f?i(t,a,n):a.leaf=n}else if(e.type="partial"){if(r.partial&&r.partial.names[e.name])throw Error("Ambiguity");r.partial||(r.partial={names:{},tests:[]});var a={};a.ptn=e.input,a.vars=e.vars,r.partial.names[e.name]=a,r.partial.tests.push(a),f?i(t,a,n):a.leaf=n}};return r.add=function(t,r){i(a(t),e,r)},r.match=function(r){var a=r.split("/").filter(n),i=t(a,e);return i?i.fn.apply(i.fn,[i.params]):void 0},r}function n(t){return!!t}function a(t){function r(t){var r=t.match(u);return{type:"var",input:r[1]}}function a(t){return{type:"fixed",input:t}}function e(t){for(var r=t.match(p),n="",a=t.length,e=0;a>e&&r;)e+=r[0].length,r[1]&&(n+=r[1]),n+="([\\w-]+)",r[3]&&(n+=r[3]),r=t.substr(e).match(p);var i=[],f=t.replace(/{([\w-]+)}/g,function(t,r){return i.push(r),"{var}"});return{type:"partial",input:RegExp(n),name:f,vars:i}}function i(t){return t.split("/").filter(n).map(function(t){return u.test(t)?r(t):p.test(t)?e(t):a(t)})}function f(t){for(var r,n="",a=[],e=0,u=t.length,p=!0;p&&u>e;){switch(r=t[e]){case")":case"(":p=!1;break;default:n+=r}e++}if(!p){var s=f(t.substr(e+1));s.length&&a.push(s)}return i(n).concat(a)}var u=/^{(\w+)}$/,p=/([\w'-]+)?{([\w-]+)}([\w'-]+)?/;return"/"==t.trim()?[{type:"fixed",input:""}]:-1==t.indexOf("(")?i(t):f(t)}rhumb=r(),rhumb.create=r,rhumb._parse=a,rhumb._findInTree=t})();